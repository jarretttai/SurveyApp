{"ast":null,"code":"import _slicedToArray from \"D:\\\\src\\\\SurveyApp\\\\SurveyAppClient\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\src\\\\SurveyApp\\\\SurveyAppClient\\\\src\\\\views\\\\Survey.js\";\nimport React, { useState, useEffect } from 'react';\nimport Question from \"../components/Question\";\nimport { Grid, Typography, Button, Paper } from '@material-ui/core';\nexport default function Survey(props) {\n  var _this = this;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      cascade = _useState2[0],\n      setCascade = _useState2[1]; //记录被级联的问题id，在表里的不显示\n\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      oldOptions = _useState4[0],\n      setOldOptions = _useState4[1];\n\n  var questions = [];\n  var answers = [];\n  var title;\n  useEffect(function () {\n    //fetch 获取 title\n    //fetch 获取 questions\n    //set state of cascade\n    //test: setcascade\n    setCascade([3, 3, 7, 8, 10, 3, 6, 9]);\n  }, []); //test\n\n  questions = [{\n    formId: 8,\n    qstnId: 1,\n    type: \"mc\",\n    content: \"question 1: multiple choices\",\n    options: [{\n      optId: 1,\n      content: \"option 1\",\n      cascadeQstnId: 3\n    }, {\n      optId: 2,\n      content: \"option 2\",\n      cascadeQstnId: 4\n    }]\n  }, {\n    formId: 8,\n    qstnId: 2,\n    type: \"realNum\",\n    content: \"question 2: real number\",\n    options: []\n  }, {\n    formId: 8,\n    qstnId: 3,\n    type: \"scale\",\n    content: \"question 3: scale\",\n    options: []\n  }, {\n    formId: 8,\n    qstnId: 4,\n    type: \"cb\",\n    content: \"question 4: checkboxes\",\n    options: [{\n      optId: 1,\n      content: \"always like this\",\n      cascadeQstnId: undefined\n    }, {\n      optId: 1,\n      content: \"always like this\",\n      cascadeQstnId: undefined\n    }]\n  }];\n  title = \"SURVEY 1\";\n  console.log(questions);\n\n  var isCascaded = function isCascaded(qstnId) {\n    for (var i = 0; i < cascade.length; i++) {\n      if (cascade[i] === qstnId) return true;\n    }\n\n    return false;\n  };\n\n  var updateOptAnswer = function updateOptAnswer(index, optId) {\n    console.log(index);\n    console.log(optId);\n    answers[index] = optId; //最后需要赋值\n\n    console.log(answers); //接着要判断是否更新cascade数组\n    //旧选项如果有级联，则改变后将级联id加回级联状态表\n\n    if (oldOptions[index]) {\n      var _cId = questions[index].options[oldOptions[index]].cascadeQstnId;\n\n      if (_cId) {\n        var cList = cascade.slice();\n        cList = cList.unshift(_cId);\n        setCascade(cList);\n        console.log(cList);\n      }\n    }\n\n    var old = oldOptions.slice();\n    old[index] = optId;\n    setOldOptions(old);\n    console.log(old);\n    console.log(cascade);\n    console.log(\"oldCascade Added!\"); //当前新选项如果有级联，则在级联状态表删除掉所有该id\n\n    var cId = questions[index].options[optId - 1].cascadeQstnId;\n\n    if (cId) {\n      var _cList = cascade.slice();\n\n      for (var i = 0; i < _cList.length; i++) {\n        if (_cList[i] == cId) {\n          _cList.splice(i, 1);\n\n          --i;\n        }\n      }\n\n      setCascade(_cList);\n      console.log(_cList);\n    }\n\n    console.log(\"new cascade Deleted!\");\n  };\n\n  var updateCascade = function updateCascade() {};\n\n  var submitResponse = function submitResponse() {};\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    direction: \"column\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }\n  }, title))), questions.map(function (q, index) {\n    if (isCascaded(q.qstnId)) return null;\n    return /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      key: index,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Question, {\n      index: index,\n      qInfo: q,\n      update: updateOptAnswer,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }\n    }));\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    onClick: submitResponse,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 11\n    }\n  }, \"Submit\"))));\n}","map":{"version":3,"sources":["D:/src/SurveyApp/SurveyAppClient/src/views/Survey.js"],"names":["React","useState","useEffect","Question","Grid","Typography","Button","Paper","Survey","props","cascade","setCascade","oldOptions","setOldOptions","questions","answers","title","formId","qstnId","type","content","options","optId","cascadeQstnId","undefined","console","log","isCascaded","i","length","updateOptAnswer","index","cId","cList","slice","unshift","old","splice","updateCascade","submitResponse","map","q"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\n\r\nimport Question from \"../components/Question\";\r\nimport { Grid, Typography, Button, Paper } from '@material-ui/core';\r\n\r\nexport default function Survey(props) {\r\n\r\n  const [cascade, setCascade] = useState([]); //记录被级联的问题id，在表里的不显示\r\n  const [oldOptions, setOldOptions] = useState([]);\r\n  let questions = [];\r\n  let answers = [];\r\n  let title;\r\n\r\n  useEffect(() => {\r\n    //fetch 获取 title\r\n    //fetch 获取 questions\r\n    //set state of cascade\r\n\r\n    //test: setcascade\r\n    setCascade([3, 3, 7, 8, 10, 3, 6, 9]);\r\n  }, []);\r\n\r\n  //test\r\n  questions = [\r\n    {\r\n      formId: 8,\r\n      qstnId: 1,\r\n      type: \"mc\",\r\n      content: \"question 1: multiple choices\",\r\n      options: [\r\n        {\r\n          optId: 1,\r\n          content: \"option 1\",\r\n          cascadeQstnId: 3\r\n        },\r\n        {\r\n          optId: 2,\r\n          content: \"option 2\",\r\n          cascadeQstnId: 4\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      formId: 8,\r\n      qstnId: 2,\r\n      type: \"realNum\",\r\n      content: \"question 2: real number\",\r\n      options: []\r\n    },\r\n    {\r\n      formId: 8,\r\n      qstnId: 3,\r\n      type: \"scale\",\r\n      content: \"question 3: scale\",\r\n      options: []\r\n    },\r\n    {\r\n      formId: 8,\r\n      qstnId: 4,\r\n      type: \"cb\",\r\n      content: \"question 4: checkboxes\",\r\n      options: [\r\n        {\r\n          optId: 1,\r\n          content: \"always like this\",\r\n          cascadeQstnId: undefined\r\n        },\r\n        {\r\n          optId: 1,\r\n          content: \"always like this\",\r\n          cascadeQstnId: undefined\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n  title = \"SURVEY 1\";\r\n  console.log(questions);\r\n  \r\n\r\n  const isCascaded = qstnId => {\r\n    for (let i=0; i<cascade.length; i++)\r\n      if (cascade[i]===qstnId) return true;\r\n    return false;\r\n  }\r\n\r\n  const updateOptAnswer = (index, optId) => {\r\n    console.log(index);\r\n    console.log(optId);\r\n    answers[index] = optId; //最后需要赋值\r\n    console.log(answers);\r\n    //接着要判断是否更新cascade数组\r\n    //旧选项如果有级联，则改变后将级联id加回级联状态表\r\n    if (oldOptions[index]) {\r\n      let cId = questions[index].options[oldOptions[index]].cascadeQstnId;\r\n      if (cId) {\r\n        let cList = cascade.slice();\r\n        cList = cList.unshift(cId);\r\n        setCascade(cList);\r\n        console.log(cList);\r\n      }\r\n    }\r\n    let old = oldOptions.slice();\r\n    old[index] = optId;\r\n    setOldOptions(old);\r\n    console.log(old);\r\n    console.log(cascade);\r\n    console.log(\"oldCascade Added!\");\r\n    //当前新选项如果有级联，则在级联状态表删除掉所有该id\r\n    let cId = questions[index].options[optId-1].cascadeQstnId;\r\n    if (cId) {   \r\n      let cList = cascade.slice();\r\n      for (let i=0; i<cList.length; i++) {\r\n        if (cList[i] == cId) {\r\n          cList.splice(i, 1);\r\n          --i;\r\n        }\r\n      }\r\n      setCascade(cList);\r\n      console.log(cList);\r\n    }\r\n    console.log(\"new cascade Deleted!\");\r\n  }\r\n\r\n  const updateCascade = () => {}\r\n\r\n  const submitResponse = () => {}\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Grid container direction=\"column\" alignItems=\"center\" >\r\n        <Grid item>\r\n          <Paper>\r\n            <Typography>\r\n              {title}\r\n            </Typography>\r\n          </Paper>\r\n        </Grid>\r\n        {\r\n          questions.map((q, index) => {\r\n            if (isCascaded(q.qstnId)) return null;\r\n            return (\r\n              <Grid item key={index}>\r\n                <Question \r\n                index={index}\r\n                qInfo = {q}\r\n                update = {updateOptAnswer} />\r\n              </Grid>\r\n            );\r\n          })\r\n        }\r\n        <Grid item>\r\n          <Button\r\n          variant = \"contained\"\r\n          color = \"primary\"\r\n          onClick = {submitResponse} >\r\n            Submit\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </React.Fragment>\r\n  );\r\n\r\n}"]},"metadata":{},"sourceType":"module"}