{"ast":null,"code":"import _slicedToArray from \"D:\\\\src\\\\SurveyApp\\\\SurveyAppClient\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\src\\\\SurveyApp\\\\SurveyAppClient\\\\src\\\\views\\\\Home.js\";\nimport React, { useState, useEffect } from \"react\";\nimport Grid from \"@material-ui/core/Grid\";\nimport { Typography, makeStyles, Toolbar, IconButton, Dialog, DialogTitle, DialogContentText, Box, DialogContent, DialogActions } from \"@material-ui/core\";\nimport UpdateIcon from '@material-ui/icons/Update';\nimport Button from \"@material-ui/core/Button\";\nimport { useCookies } from 'react-cookie';\nimport AppHeader from \"../components/AppHeader\";\nimport AppDrawer from \"../components/AppDrawer\";\nimport SurveyCard from \"../components/SurveyCard\";\nimport styles from \"../styles/HomePageStyle\";\nvar useStyles = makeStyles(styles);\nexport default function Home(props) {\n  var _this = this;\n\n  var classes = useStyles();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      drawerOpen = _useState2[0],\n      setDrawerOpen = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      dialogOpen = _useState4[0],\n      setDialogOpen = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      dialogUrl = _useState6[0],\n      setDialogUrl = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      forms = _useState8[0],\n      setForms = _useState8[1];\n\n  var _useCookies = useCookies(),\n      _useCookies2 = _slicedToArray(_useCookies, 1),\n      cookies = _useCookies2[0];\n\n  useEffect(function () {\n    //验证cookies以检查登陆状态\n    if (cookies.mail == null) return props.history.replace(\"/login\");\n    var headers = new Headers();\n    headers.append(\"Content-Type\", \"application/json;charset=UTF-8\");\n    var init = {\n      method: 'GET',\n      headers: headers\n    };\n    fetch(\"/api/forms\", init).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      return JSON.parse(JSON.stringify(data));\n    }).then(function (data) {\n      return setForms(data);\n    });\n  }, []); //[]空参数是为了阻止无限循环，参考 https://medium.com/@andrewmyint/infinite-loop-inside-useeffect-react-hooks-6748de62871\n\n  var handleDrawerOpen = function handleDrawerOpen(e) {\n    setDrawerOpen(true);\n  };\n\n  var handleDrawerClose = function handleDrawerClose(e) {\n    setDrawerOpen(false);\n  };\n\n  var handleNewForm = function handleNewForm(e) {\n    var headers = new Headers();\n    headers.append(\"Content-Type\", \"application/json;charset=UTF-8\");\n    var init = {\n      method: 'POST',\n      headers: headers\n    };\n    fetch(\"/api/forms\", init).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      props.history.push(\"/edit/\".concat(data[0]));\n    });\n  };\n\n  var jumpToPage = function jumpToPage(url) {\n    console.log(window.location.href);\n    props.history.push(url);\n  };\n\n  var handleDialogOpen = function handleDialogOpen(url) {\n    setDialogUrl(url);\n    setDialogOpen(true);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AppHeader, {\n    handleDrawerOpen: handleDrawerOpen,\n    drawerOpen: drawerOpen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(AppDrawer, {\n    open: drawerOpen,\n    handleDrawerClose: handleDrawerClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    direction: \"row\",\n    justify: \"center\",\n    alignItems: \"flex-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    sm: 1,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    container: true,\n    md: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    \"flex-grow\": 1,\n    className: classes.listHead,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle2\",\n    className: classes.headFont,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }\n  }, \"Recent Forms\")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    className: classes.leftHead,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    className: classes.updateIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(UpdateIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handleNewForm,\n    className: classes.addButton,\n    variant: \"contained\",\n    size: \"small\",\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, \"+  new form\"))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    sm: 1,\n    md: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    direction: \"column\",\n    alignItems: \"center\",\n    className: classes.mainArea,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 6\n    }\n  }, forms instanceof Array ? forms.map(function (form, index) {\n    return /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      key: index,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(SurveyCard, {\n      index: index,\n      name: form.title,\n      id: form.formId,\n      date: form.date,\n      jump: jumpToPage,\n      openDialog: handleDialogOpen,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 13\n      }\n    }));\n  }) : null), /*#__PURE__*/React.createElement(Dialog, {\n    open: dialogOpen,\n    onClose: function onClose() {\n      setDialogOpen(false);\n    },\n    maxWidth: \"sm\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DialogContentText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 11\n    }\n  }, \"Copy address below and send it to your friends\"), /*#__PURE__*/React.createElement(Box, {\n    className: classes.urlBox,\n    borderRadius: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle2\",\n    className: classes.url,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }\n  }, dialogUrl))), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: function onClick() {\n      setDialogOpen(false);\n    },\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, \"Close\"))));\n}","map":{"version":3,"sources":["D:/src/SurveyApp/SurveyAppClient/src/views/Home.js"],"names":["React","useState","useEffect","Grid","Typography","makeStyles","Toolbar","IconButton","Dialog","DialogTitle","DialogContentText","Box","DialogContent","DialogActions","UpdateIcon","Button","useCookies","AppHeader","AppDrawer","SurveyCard","styles","useStyles","Home","props","classes","drawerOpen","setDrawerOpen","dialogOpen","setDialogOpen","dialogUrl","setDialogUrl","forms","setForms","cookies","mail","history","replace","headers","Headers","append","init","method","fetch","then","res","json","data","JSON","parse","stringify","handleDrawerOpen","e","handleDrawerClose","handleNewForm","push","jumpToPage","url","console","log","window","location","href","handleDialogOpen","listHead","headFont","leftHead","updateIcon","addButton","mainArea","Array","map","form","index","title","formId","date","urlBox"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,SAASC,UAAT,EAAqBC,UAArB,EAAiCC,OAAjC,EAA0CC,UAA1C,EAAsDC,MAAtD,EAA8DC,WAA9D,EAA2EC,iBAA3E,EAA8FC,GAA9F,EAAmGC,aAAnG,EAAkHC,aAAlH,QAAuI,mBAAvI;AACA,OAAOC,UAAP,MAAuB,2BAAvB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,SAASC,UAAT,QAA2B,cAA3B;AAEA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AAEA,IAAMC,SAAS,GAAGhB,UAAU,CAACe,MAAD,CAA5B;AAEA,eAAe,SAASE,IAAT,CAAcC,KAAd,EAAqB;AAAA;;AAElC,MAAMC,OAAO,GAAGH,SAAS,EAAzB;;AAFkC,kBAGEpB,QAAQ,CAAC,KAAD,CAHV;AAAA;AAAA,MAG3BwB,UAH2B;AAAA,MAGfC,aAHe;;AAAA,mBAIEzB,QAAQ,CAAC,KAAD,CAJV;AAAA;AAAA,MAI3B0B,UAJ2B;AAAA,MAIfC,aAJe;;AAAA,mBAKA3B,QAAQ,CAAC,CAAD,CALR;AAAA;AAAA,MAK3B4B,SAL2B;AAAA,MAKhBC,YALgB;;AAAA,mBAMR7B,QAAQ,CAAC,EAAD,CANA;AAAA;AAAA,MAM3B8B,KAN2B;AAAA,MAMpBC,QANoB;;AAAA,oBAOhBhB,UAAU,EAPM;AAAA;AAAA,MAO3BiB,OAP2B;;AASlC/B,EAAAA,SAAS,CACP,YAAM;AACJ;AACA,QAAI+B,OAAO,CAACC,IAAR,IAAc,IAAlB,EACE,OAAOX,KAAK,CAACY,OAAN,CAAcC,OAAd,CAAsB,QAAtB,CAAP;AACF,QAAIC,OAAO,GAAG,IAAIC,OAAJ,EAAd;AACAD,IAAAA,OAAO,CAACE,MAAR,CAAe,cAAf,EAA+B,gCAA/B;AACA,QAAMC,IAAI,GAAG;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXJ,MAAAA,OAAO,EAAEA;AAFE,KAAb;AAIAK,IAAAA,KAAK,CAAC,YAAD,EAAeF,IAAf,CAAL,CACGG,IADH,CACQ,UAAAC,GAAG;AAAA,aAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,KADX,EAEGF,IAFH,CAES,UAAAG,IAAI;AAAA,aAAIC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeH,IAAf,CAAX,CAAJ;AAAA,KAFb,EAGGH,IAHH,CAGS,UAAAG,IAAI;AAAA,aAAId,QAAQ,CAACc,IAAD,CAAZ;AAAA,KAHb;AAID,GAfM,EAgBP,EAhBO,CAAT,CATkC,CA0B/B;;AAGH,MAAMI,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,CAAD,EAAO;AAC9BzB,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAFD;;AAIA,MAAM0B,iBAAiB,GAAG,SAApBA,iBAAoB,CAAAD,CAAC,EAAI;AAC7BzB,IAAAA,aAAa,CAAC,KAAD,CAAb;AACD,GAFD;;AAIA,MAAM2B,aAAa,GAAG,SAAhBA,aAAgB,CAAAF,CAAC,EAAI;AACzB,QAAId,OAAO,GAAG,IAAIC,OAAJ,EAAd;AACAD,IAAAA,OAAO,CAACE,MAAR,CAAe,cAAf,EAA+B,gCAA/B;AACA,QAAMC,IAAI,GAAG;AACXC,MAAAA,MAAM,EAAE,MADG;AAEXJ,MAAAA,OAAO,EAAEA;AAFE,KAAb;AAIAK,IAAAA,KAAK,CAAC,YAAD,EAAeF,IAAf,CAAL,CACGG,IADH,CACQ,UAAAC,GAAG;AAAA,aAAIA,GAAG,CAACC,IAAJ,EAAJ;AAAA,KADX,EAEGF,IAFH,CAEQ,UAAAG,IAAI,EAAI;AAACvB,MAAAA,KAAK,CAACY,OAAN,CAAcmB,IAAd,iBAA4BR,IAAI,CAAC,CAAD,CAAhC;AAAwC,KAFzD;AAID,GAXD;;AAaA,MAAMS,UAAU,GAAG,SAAbA,UAAa,CAACC,GAAD,EAAS;AAC1BC,IAAAA,OAAO,CAACC,GAAR,CAAYC,MAAM,CAACC,QAAP,CAAgBC,IAA5B;AACAtC,IAAAA,KAAK,CAACY,OAAN,CAAcmB,IAAd,CAAmBE,GAAnB;AACD,GAHD;;AAKA,MAAMM,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACN,GAAD,EAAS;AAChC1B,IAAAA,YAAY,CAAC0B,GAAD,CAAZ;AACA5B,IAAAA,aAAa,CAAC,IAAD,CAAb;AACD,GAHD;;AAKA,sBACE,oBAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAEE,oBAAC,SAAD;AAAW,IAAA,gBAAgB,EAAEsB,gBAA7B;AAA+C,IAAA,UAAU,EAAEzB,UAA3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,eAGE,oBAAC,SAAD;AAAW,IAAA,IAAI,EAAEA,UAAjB;AAA6B,IAAA,iBAAiB,EAAE2B,iBAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,eAIE,oBAAC,OAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJF,eAME,oBAAC,IAAD;AAAM,IAAA,SAAS,MAAf;AAAgB,IAAA,SAAS,EAAC,KAA1B;AAAgC,IAAA,OAAO,EAAC,QAAxC;AAAiD,IAAA,UAAU,EAAC,YAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,CAAf;AAAkB,IAAA,EAAE,EAAE,CAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,eAEE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,SAAS,MAApB;AAAqB,IAAA,EAAE,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,iBAAW,CAAtB;AAAyB,IAAA,SAAS,EAAE5B,OAAO,CAACuC,QAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,UAAD;AAAY,IAAA,OAAO,EAAC,WAApB;AAAgC,IAAA,SAAS,EAAEvC,OAAO,CAACwC,QAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,CADF,eAIE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,SAAS,EAAExC,OAAO,CAACyC,QAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,UAAD;AAAY,IAAA,SAAS,EAAEzC,OAAO,CAAC0C,UAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CADF,CAJF,eASE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,MAAD;AACA,IAAA,OAAO,EAAEb,aADT;AAEA,IAAA,SAAS,EAAE7B,OAAO,CAAC2C,SAFnB;AAGA,IAAA,OAAO,EAAC,WAHR;AAIA,IAAA,IAAI,EAAC,OAJL;AAKA,IAAA,KAAK,EAAC,SALN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,CATF,CAFF,eAsBE,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,CAAf;AAAkB,IAAA,EAAE,EAAE,CAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAtBF,CANF,eA+BC,oBAAC,IAAD;AACC,IAAA,SAAS,MADV;AAEC,IAAA,SAAS,EAAC,QAFX;AAGC,IAAA,UAAU,EAAC,QAHZ;AAIC,IAAA,SAAS,EAAE3C,OAAO,CAAC4C,QAJpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMGrC,KAAK,YAAYsC,KAAjB,GACAtC,KAAK,CAACuC,GAAN,CAAU,UAACC,IAAD,EAAOC,KAAP;AAAA,wBACR,oBAAC,IAAD;AAAM,MAAA,IAAI,MAAV;AAAW,MAAA,GAAG,EAAEA,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE,oBAAC,UAAD;AACE,MAAA,KAAK,EAAEA,KADT;AAEE,MAAA,IAAI,EAAED,IAAI,CAACE,KAFb;AAGE,MAAA,EAAE,EAAEF,IAAI,CAACG,MAHX;AAIE,MAAA,IAAI,EAAEH,IAAI,CAACI,IAJb;AAKE,MAAA,IAAI,EAAEpB,UALR;AAME,MAAA,UAAU,EAAEO,gBANd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADQ;AAAA,GAAV,CADA,GAYI,IAlBP,CA/BD,eAqDA,oBAAC,MAAD;AAAQ,IAAA,IAAI,EAAEnC,UAAd;AAA0B,IAAA,OAAO,EAAE,mBAAM;AAACC,MAAAA,aAAa,CAAC,KAAD,CAAb;AAAsB,KAAhE;AAAkE,IAAA,QAAQ,EAAC,IAA3E;AAAgF,IAAA,SAAS,MAAzF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAEI,oBAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sDADF,eAEE,oBAAC,GAAD;AAAK,IAAA,SAAS,EAAEJ,OAAO,CAACoD,MAAxB;AAAgC,IAAA,YAAY,EAAE,CAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,UAAD;AAAY,IAAA,OAAO,EAAC,WAApB;AAAgC,IAAA,SAAS,EAAEpD,OAAO,CAACgC,GAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA0D3B,SAA1D,CADF,CAFF,CAFJ,eAQI,oBAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE,mBAAM;AAACD,MAAAA,aAAa,CAAC,KAAD,CAAb;AAAsB,KAA9C;AAAgD,IAAA,KAAK,EAAC,SAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADF,CARJ,CArDA,CADF;AAsED","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { Typography, makeStyles, Toolbar, IconButton, Dialog, DialogTitle, DialogContentText, Box, DialogContent, DialogActions } from \"@material-ui/core\";\r\nimport UpdateIcon from '@material-ui/icons/Update';\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { useCookies } from 'react-cookie';\r\n\r\nimport AppHeader from \"../components/AppHeader\";\r\nimport AppDrawer from \"../components/AppDrawer\";\r\nimport SurveyCard from \"../components/SurveyCard\";\r\nimport styles from \"../styles/HomePageStyle\";\r\n\r\nconst useStyles = makeStyles(styles);\r\n\r\nexport default function Home(props) {\r\n\r\n  const classes = useStyles();\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  const [dialogUrl, setDialogUrl] = useState(0);\r\n  const [forms, setForms] = useState([]);\r\n  const [cookies] = useCookies();\r\n\r\n  useEffect(\r\n    () => {\r\n      //验证cookies以检查登陆状态\r\n      if (cookies.mail==null) \r\n        return props.history.replace(\"/login\");\r\n      let headers = new Headers();\r\n      headers.append(\"Content-Type\", \"application/json;charset=UTF-8\");\r\n      const init = {\r\n        method: 'GET',\r\n        headers: headers\r\n      };\r\n      fetch(\"/api/forms\", init)\r\n        .then(res => res.json())\r\n        .then (data => JSON.parse(JSON.stringify(data)))\r\n        .then (data => setForms(data));\r\n    }, \r\n    []\r\n  ); //[]空参数是为了阻止无限循环，参考 https://medium.com/@andrewmyint/infinite-loop-inside-useeffect-react-hooks-6748de62871\r\n\r\n\r\n  const handleDrawerOpen = (e) => {\r\n    setDrawerOpen(true);\r\n  }\r\n\r\n  const handleDrawerClose = e => {\r\n    setDrawerOpen(false);\r\n  }\r\n\r\n  const handleNewForm = e => {\r\n    let headers = new Headers();\r\n    headers.append(\"Content-Type\", \"application/json;charset=UTF-8\");\r\n    const init = {\r\n      method: 'POST',\r\n      headers: headers\r\n    };\r\n    fetch(\"/api/forms\", init)\r\n      .then(res => res.json())\r\n      .then(data => {props.history.push(`/edit/${data[0]}`);});\r\n      \r\n  }\r\n\r\n  const jumpToPage = (url) => {\r\n    console.log(window.location.href);\r\n    props.history.push(url);\r\n  }\r\n\r\n  const handleDialogOpen = (url) => {\r\n    setDialogUrl(url);\r\n    setDialogOpen(true);\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n\r\n      <AppHeader handleDrawerOpen={handleDrawerOpen} drawerOpen={drawerOpen} />\r\n      <AppDrawer open={drawerOpen} handleDrawerClose={handleDrawerClose} />\r\n      <Toolbar />\r\n      \r\n      <Grid container direction=\"row\" justify=\"center\" alignItems=\"flex-start\">\r\n        <Grid item sm={1} md={3}></Grid>\r\n        <Grid item container md>\r\n          <Grid item flex-grow={1} className={classes.listHead}>\r\n            <Typography variant=\"subtitle2\" className={classes.headFont}>Recent Forms</Typography>\r\n          </Grid>\r\n          <Grid item className={classes.leftHead} >\r\n            <IconButton className={classes.updateIcon}>\r\n              <UpdateIcon />\r\n            </IconButton>\r\n          </Grid>\r\n          <Grid item>\r\n            <Button \r\n            onClick={handleNewForm}\r\n            className={classes.addButton} \r\n            variant=\"contained\" \r\n            size=\"small\" \r\n            color=\"primary\">\r\n              +  new form\r\n            </Button>\r\n          </Grid>\r\n        </Grid>\r\n        <Grid item sm={1} md={3}></Grid>\r\n      </Grid>\r\n      \r\n     <Grid \r\n      container \r\n      direction=\"column\" \r\n      alignItems=\"center\" \r\n      className={classes.mainArea} >\r\n      {\r\n        forms instanceof Array?\r\n        forms.map((form, index) => (\r\n          <Grid item key={index}>\r\n            <SurveyCard \r\n              index={index} \r\n              name={form.title} \r\n              id={form.formId} \r\n              date={form.date} \r\n              jump={jumpToPage}\r\n              openDialog={handleDialogOpen}\r\n            />\r\n          </Grid>\r\n        )): null\r\n      }     \r\n    </Grid>\r\n\r\n    <Dialog open={dialogOpen} onClose={() => {setDialogOpen(false);}} maxWidth=\"sm\" fullWidth>\r\n        {/* <DialogTitle>Send</DialogTitle> */}\r\n        <DialogContent >\r\n          <DialogContentText>Copy address below and send it to your friends</DialogContentText>\r\n          <Box className={classes.urlBox} borderRadius={4}> \r\n            <Typography variant=\"subtitle2\" className={classes.url} >{dialogUrl}</Typography>\r\n          </Box>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => {setDialogOpen(false);}} color=\"primary\">\r\n            Close\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </React.Fragment>\r\n  );\r\n} \r\n"]},"metadata":{},"sourceType":"module"}